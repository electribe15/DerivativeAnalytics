{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"trusted":true},"outputs":[],"source":["import datetime\n","import numpy as np\n","import pandas as pd"]},{"cell_type":"code","execution_count":1,"metadata":{"trusted":true},"outputs":[{"ename":"ImportError","evalue":"cannot import name 'escape' from 'jinja2' (/Users/Massimiliano/opt/anaconda3/lib/python3.9/site-packages/jinja2/__init__.py)","output_type":"error","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mImportError\u001b[0m                               Traceback (most recent call last)","\u001b[1;32m/electribe15/DerivativeAnalytics/PCA Dashboard copy.ipynb Cell 2\u001b[0m in \u001b[0;36m1\n\u001b[0;32m----> <a href='vscode-notebook-cell://github/electribe15/DerivativeAnalytics/PCA%20Dashboard%20copy.ipynb#W1sdnNjb2RlLXZmcw%3D%3D?line=0'>1</a>\u001b[0m \u001b[39mimport\u001b[39;00m \u001b[39mdash\u001b[39;00m\n\u001b[1;32m      <a href='vscode-notebook-cell://github/electribe15/DerivativeAnalytics/PCA%20Dashboard%20copy.ipynb#W1sdnNjb2RlLXZmcw%3D%3D?line=1'>2</a>\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39mdash\u001b[39;00m \u001b[39mimport\u001b[39;00m dcc, html\n\u001b[1;32m      <a href='vscode-notebook-cell://github/electribe15/DerivativeAnalytics/PCA%20Dashboard%20copy.ipynb#W1sdnNjb2RlLXZmcw%3D%3D?line=2'>3</a>\u001b[0m \u001b[39mimport\u001b[39;00m \u001b[39mdash_bootstrap_components\u001b[39;00m \u001b[39mas\u001b[39;00m \u001b[39mdbc\u001b[39;00m\n","File \u001b[0;32m~/opt/anaconda3/lib/python3.9/site-packages/dash/__init__.py:5\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[39m# pylint: disable=C0413\u001b[39;00m\n\u001b[1;32m      2\u001b[0m \u001b[39m# __plotly_dash is for the \"make sure you don't have a dash.py\" check\u001b[39;00m\n\u001b[1;32m      3\u001b[0m \u001b[39m# must come before any other imports.\u001b[39;00m\n\u001b[1;32m      4\u001b[0m __plotly_dash \u001b[39m=\u001b[39m \u001b[39mTrue\u001b[39;00m\n\u001b[0;32m----> 5\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39m.\u001b[39;00m\u001b[39mdependencies\u001b[39;00m \u001b[39mimport\u001b[39;00m (  \u001b[39m# noqa: F401,E402\u001b[39;00m\n\u001b[1;32m      6\u001b[0m     Input,  \u001b[39m# noqa: F401,E402\u001b[39;00m\n\u001b[1;32m      7\u001b[0m     Output,  \u001b[39m# noqa: F401,E402,\u001b[39;00m\n\u001b[1;32m      8\u001b[0m     State,  \u001b[39m# noqa: F401,E402\u001b[39;00m\n\u001b[1;32m      9\u001b[0m     ClientsideFunction,  \u001b[39m# noqa: F401,E402\u001b[39;00m\n\u001b[1;32m     10\u001b[0m     MATCH,  \u001b[39m# noqa: F401,E402\u001b[39;00m\n\u001b[1;32m     11\u001b[0m     ALL,  \u001b[39m# noqa: F401,E402\u001b[39;00m\n\u001b[1;32m     12\u001b[0m     ALLSMALLER,  \u001b[39m# noqa: F401,E402\u001b[39;00m\n\u001b[1;32m     13\u001b[0m )  \u001b[39m# noqa: F401,E402\u001b[39;00m\n\u001b[1;32m     14\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39m.\u001b[39;00m \u001b[39mimport\u001b[39;00m development  \u001b[39m# noqa: F401,E402\u001b[39;00m\n\u001b[1;32m     15\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39m.\u001b[39;00m \u001b[39mimport\u001b[39;00m exceptions  \u001b[39m# noqa: F401,E402\u001b[39;00m\n","File \u001b[0;32m~/opt/anaconda3/lib/python3.9/site-packages/dash/dependencies.py:4\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[39mimport\u001b[39;00m \u001b[39mjson\u001b[39;00m\n\u001b[1;32m      2\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39mdash\u001b[39;00m\u001b[39m.\u001b[39;00m\u001b[39mdevelopment\u001b[39;00m\u001b[39m.\u001b[39;00m\u001b[39mbase_component\u001b[39;00m \u001b[39mimport\u001b[39;00m Component\n\u001b[0;32m----> 4\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39m.\u001b[39;00m\u001b[39m_validate\u001b[39;00m \u001b[39mimport\u001b[39;00m validate_callback\n\u001b[1;32m      5\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39m.\u001b[39;00m\u001b[39m_grouping\u001b[39;00m \u001b[39mimport\u001b[39;00m flatten_grouping, make_grouping_by_index\n\u001b[1;32m      8\u001b[0m \u001b[39mclass\u001b[39;00m \u001b[39m_Wildcard\u001b[39;00m:  \u001b[39m# pylint: disable=too-few-public-methods\u001b[39;00m\n","File \u001b[0;32m~/opt/anaconda3/lib/python3.9/site-packages/dash/_validate.py:5\u001b[0m\n\u001b[1;32m      3\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39mtextwrap\u001b[39;00m \u001b[39mimport\u001b[39;00m dedent\n\u001b[1;32m      4\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39mkeyword\u001b[39;00m \u001b[39mimport\u001b[39;00m iskeyword\n\u001b[0;32m----> 5\u001b[0m \u001b[39mimport\u001b[39;00m \u001b[39mflask\u001b[39;00m\n\u001b[1;32m      7\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39m.\u001b[39;00m\u001b[39m_grouping\u001b[39;00m \u001b[39mimport\u001b[39;00m grouping_len, map_grouping\n\u001b[1;32m      8\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39m.\u001b[39;00m\u001b[39mdevelopment\u001b[39;00m\u001b[39m.\u001b[39;00m\u001b[39mbase_component\u001b[39;00m \u001b[39mimport\u001b[39;00m Component\n","File \u001b[0;32m~/opt/anaconda3/lib/python3.9/site-packages/flask/__init__.py:14\u001b[0m\n\u001b[1;32m      2\u001b[0m \u001b[39m\"\"\"\u001b[39;00m\n\u001b[1;32m      3\u001b[0m \u001b[39m    flask\u001b[39;00m\n\u001b[1;32m      4\u001b[0m \u001b[39m    ~~~~~\u001b[39;00m\n\u001b[0;32m   (...)\u001b[0m\n\u001b[1;32m     10\u001b[0m \u001b[39m    :license: BSD-3-Clause\u001b[39;00m\n\u001b[1;32m     11\u001b[0m \u001b[39m\"\"\"\u001b[39;00m\n\u001b[1;32m     12\u001b[0m \u001b[39m# utilities we import from Werkzeug and Jinja2 that are unused\u001b[39;00m\n\u001b[1;32m     13\u001b[0m \u001b[39m# in the module but are exported as public interface.\u001b[39;00m\n\u001b[0;32m---> 14\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39mjinja2\u001b[39;00m \u001b[39mimport\u001b[39;00m escape\n\u001b[1;32m     15\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39mjinja2\u001b[39;00m \u001b[39mimport\u001b[39;00m Markup\n\u001b[1;32m     16\u001b[0m \u001b[39mfrom\u001b[39;00m \u001b[39mwerkzeug\u001b[39;00m\u001b[39m.\u001b[39;00m\u001b[39mexceptions\u001b[39;00m \u001b[39mimport\u001b[39;00m abort\n","\u001b[0;31mImportError\u001b[0m: cannot import name 'escape' from 'jinja2' (/Users/Massimiliano/opt/anaconda3/lib/python3.9/site-packages/jinja2/__init__.py)"]}],"source":["import dash\n","from dash import dcc, html\n","import dash_bootstrap_components as dbc\n","from dash.dependencies import Input, Output"]},{"cell_type":"code","execution_count":3,"metadata":{"trusted":true},"outputs":[],"source":["import plotly.graph_objs as go\n","import plotly.io as pio"]},{"cell_type":"code","execution_count":4,"metadata":{"trusted":true},"outputs":[{"ename":"ModuleNotFoundError","evalue":"No module named 'openbb_terminal'","output_type":"error","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mModuleNotFoundError\u001b[0m                       Traceback (most recent call last)","\u001b[0;32m<ipython-input-4-005f3169f47b>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m()\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m \u001b[0;32mfrom\u001b[0m \u001b[0mopenbb_terminal\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msdk\u001b[0m \u001b[0;32mimport\u001b[0m \u001b[0mopenbb\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m","\u001b[0;31mModuleNotFoundError\u001b[0m: No module named 'openbb_terminal'"]}],"source":["from openbb_terminal.sdk import openbb"]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":["from sklearn.decomposition import PCA"]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":["pio.templates.default=\"plotly\""]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":["app=dash.Dash(__name__, external_stylesheets=[dbc.themes.BOOTSTRAP])"]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":["ticker_field= [\n","    html.Label(\"Enter Ticker Symbols:\"),\n","    dcc.Input(\n","    id=\"ticker-input\",\n","    type=\"text\",\n","    ),\n","]"]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":["components_field=[\n","    html.Label(\"Select Number of Components:\"),\n","    dcc.Dropdown(\n","        id=\"component-dropdown\",\n","        options=[{\"label\":i,\"value\":i} for i in\n","range(1,6)],\n","        value=3,\n","    ),\n","]"]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":["date_picker_field=[\n","    html.Label(\"Select Date Range:\"),\n","    dcc.DatePickerRange(\n","        id=\"date-picker\",\n","    start_date=datetime.datetime.now()-\n","datetime.timedelta(365*3),\n","    end_date=datetime.datetime.now(),\n","    display_format=\"YYY-MM-DD\"\n","    ),\n","]\n","submit=[\n","    html.Button(\"Submit\",id=\"submit-button\"),\n","]"]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":[" app.layout=dbc.Container(\n"," [\n","     html.H1(\"PCS on Stock Returns\"),\n","     #Ticker input\n","     dbc.Row([dbc.Col(ticker_field)]),\n","     dbc.Row([dbc.Col(components_field)]),\n","     dbc.Row([dbc.Col(date_picker_field)]),\n","     dbc.Row([dbc.Col(submit)]),\n","     \n","     #Charts\n","     dbc.Row(\n","        [\n","            dbc.Col([dcc.Graph(id=\"bar-chart\")],\n","width=4),\n","            dbc.Col([dcc.Graph(id=\"line-chart\")],\n","width=4),\n","        ]  \n","     ),\n","    ]\n","  )"]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":["  @app.callback(\n","    [\n","        Output(\"bar-chart\",\"figure\"),\n","        Output(\"line-chart\",\"figure\"),\n","    ],\n","    \n","    [Input(\"submit-button\",\"n_clicks\")],\n","    \n","    [\n","        dash.dependencies.State(\"ticker-input\",\"value\"),\n","        dash.dependencies.State(\"component-dropdown\",\"value\"),\n","        dash.dependencies.State(\"date-picker\", \"start-date\"),\n","        dash.dependencies.State(\"date-picker\",\"end_date\"),\n","    ],\n"," )\n","def update_graphs (n_clicks, tickers, n_components, start_Date, end_date):\n","    if not tickers:\n","        return {}, {}\n","    #Parse inputs from user\n","    tickers=tickers.split(\",\")\n","    \n","    start_date=datetime.datetime.strptime(\n","         start_date,\n","        \"%Y-%m-%dT%H:%M:%S.%f\"\n","    ).date()\n","    \n","    #Download stock data\n","    data=openbb.economy.index(\n","        tickers,\n","        start_date=start_date,\n","        end_date=end_date\n","    )\n","    daily_returns=data.pct_change().dropna()\n","    \n","    #Apply PCA\n","    pca= PCA(n_components=n_components)\n","    pca.fit(daily_returns)\n","    \n","    explained_var_ratio=pca.explained_variancee_ratio_\n","    \n","    #Bar chart for individual explained variance\n","    bar_chart=go.Figure(\n","        data=[\n","            go.Bar(\n","            x=[\"PC\" + str(i+1) for i in\n","range (n_components)],\n","                  y=explained_var_ratio,\n","            )\n","        ],\n","        layout=go.Layout(\n","        title=\"Explained Variance by Component\",\n","        xaxis=dict(title=\"Principal Component\"),\n","        yaxis=dict(title=\"Cumulative Explained Variance\"),\n","        ),\n","    )\n","    return bar_chart, line_chart\n","\n","if __name__== \"__main__\":\n","    app.run_server(debug=True)\n","    \n","    \n","    \n","    "]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":[]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":[","]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":[]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":[]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":[]},{"cell_type":"code","execution_count":null,"metadata":{"trusted":true},"outputs":[],"source":[]}],"metadata":{"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.13"}},"nbformat":4,"nbformat_minor":2}
